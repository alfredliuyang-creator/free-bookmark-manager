<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹¦ç­¾ç®¡ç†å™¨åŸå‹å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        /* æ¡Œé¢å®¹å™¨ */
        .desktop {
            position: relative;
            width: 100vw;
            height: 100vh;
            margin-left: 60px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23ffffff" stroke-width="0.5" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }

        /* å±å¹•åˆ‡æ¢æŒ‰é’® */
        .screen-switch {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .screen-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .screen-dot.active {
            background: #ffffff;
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.3);
        }

        .screen-dot:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.6);
        }

        /* å±å¹•å®¹å™¨ */
        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .screen.active {
            display: block;
            opacity: 1;
        }

        /* æ¡Œé¢å›¾æ ‡ */
        .desktop-icon {
            position: absolute;
            width: 80px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 8px;
        }

        /* åˆ é™¤å°å‰æ ·å¼ */
        .desktop-icon .delete-cross {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 16px;
            height: 16px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .desktop-icon .delete-cross:hover {
            background: #ff6666;
            transform: scale(1.1);
        }

        /* æ˜¾ç¤ºåˆ é™¤æ¨¡å¼æ—¶æ˜¾ç¤ºå°å‰ */
        .delete-mode .desktop-icon .delete-cross {
            display: flex;
        }

        .delete-mode .desktop-icon {
            cursor: default;
        }

        /* åˆ é™¤åŠ¨ç”» */
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.8);
            }
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .desktop-icon:active {
            transform: scale(0.95);
        }

        .icon-image {
            width: 48px;
            height: 48px;
            margin: 0 auto 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .icon-label {
            color: white;
            font-size: 12px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            word-wrap: break-word;
            line-height: 1.2;
        }

        .desktop-icon.dragging {
            opacity: 0.7;
            transform: scale(1.05);
            z-index: 100;
        }

        /* å·¦ä¾§å·¥å…·æ  */
        .toolbar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 60px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            z-index: 1000;
        }

        .tool-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* æ·»åŠ ä¹¦ç­¾å¼¹çª— */
        .add-bookmark-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            display: none;
            z-index: 2000;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1500;
        }

        .modal-overlay.active {
            display: block;
        }

        .modal-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        /* URLè¾“å…¥ç»„å¸ƒå±€ */
        .url-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .url-input-group .form-input {
            flex: 1;
        }

        /* Faviconé¢„è§ˆæ ·å¼ */
        .favicon-preview {
            margin-top: 8px;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .favicon-preview img {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }

        .favicon-preview span {
            flex: 1;
            font-size: 14px;
            color: #666;
        }

        .favicon-preview.loading {
            background: #fff3cd;
            border-color: #ffeaa7;
        }

        .favicon-preview.success {
            background: #d1edff;
            border-color: #b8daff;
        }

        .favicon-preview.error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        /* Emojié€‰æ‹©å™¨æ ·å¼ */
        .emoji-selector {
            margin-top: 10px;
        }

        .emoji-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            max-height: 120px;
            overflow-y: auto;
        }

        .emoji-option {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 18px;
            background: white;
            border: 1px solid #e0e0e0;
        }

        .emoji-option:hover {
            background: #e3f2fd;
            transform: scale(1.1);
            border-color: #2196f3;
        }

        .emoji-option.selected {
            background: #2196f3;
            border-color: #1976d2;
            transform: scale(1.1);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .desktop {
                margin-left: 50px;
            }
            
            .desktop-icon {
                width: 60px;
            }
            
            .icon-image {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .toolbar {
                width: 50px;
            }
            
            .tool-btn {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }
            
            .screen-switch {
                right: 10px;
                gap: 10px;
            }
            
            .screen-dot {
                width: 16px;
                height: 16px;
            }
            
            .page-indicator {
                left: 70px;
            }
        }

        /* é¡µé¢æŒ‡ç¤ºå™¨ */
        .page-indicator {
            position: fixed;
            bottom: 20px;
            left: 80px;
            transform: none;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .page-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .page-dot.active {
            background: white;
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <!-- æ¡Œé¢èƒŒæ™¯ -->
    <div class="desktop" id="desktop">
        <!-- å±å¹•1 -->
        <div class="screen active" data-screen="0">
            <!-- ç¬¬ä¸€å±å›¾æ ‡ -->
            <div class="desktop-icon" style="top: 20px; left: 20px;" data-url="https://www.google.com" data-id="icon_default_1">
                <div class="delete-cross" onclick="deleteIcon(this)">Ã—</div>
                <div class="icon-image" style="background: linear-gradient(135deg, #4285f4, #34a853);">ğŸŒ</div>
                <div class="icon-label">Google</div>
            </div>
            
            <div class="desktop-icon" style="top: 20px; left: 120px;" data-url="https://github.com">
                <div class="delete-cross" onclick="deleteIcon(this)">Ã—</div>
                <div class="icon-image" style="background: linear-gradient(135deg, #333, #666);">ğŸ’»</div>
                <div class="icon-label">GitHub</div>
            </div>
            
            <div class="desktop-icon" style="top: 20px; left: 220px;" data-url="https://stackoverflow.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #f48024, #da5b0b);">â“</div>
                <div class="icon-label">Stack Overflow</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; left: 20px;" data-url="https://youtube.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #ff0000, #cc0000);">ğŸ“º</div>
                <div class="icon-label">YouTube</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; left: 120px;" data-url="https://twitter.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #1da1f2, #0d8bd9);">ğŸ¦</div>
                <div class="icon-label">Twitter</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; left: 220px;" data-url="https://linkedin.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #0077b5, #005885);">ğŸ’¼</div>
                <div class="icon-label">LinkedIn</div>
            </div>
            
            <div class="desktop-icon" style="top: 220px; left: 20px;" data-url="https://figma.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #f24e1e, #a259ff);">ğŸ¨</div>
                <div class="icon-label">Figma</div>
            </div>
            
            <div class="desktop-icon" style="top: 220px; left: 120px;" data-url="https://notion.so">
                <div class="icon-image" style="background: linear-gradient(135deg, #000000, #37352f);">ğŸ“</div>
                <div class="icon-label">Notion</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 20px;" data-url="https://facebook.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #1877f2, #42a5f5);">ğŸ‘¥</div>
                <div class="icon-label">Facebook</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 120px;" data-url="https://instagram.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #e4405f, #fd5949);">ğŸ“¸</div>
                <div class="icon-label">Instagram</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 220px;" data-url="https://whatsapp.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #25d366, #128c7e);">ğŸ’¬</div>
                <div class="icon-label">WhatsApp</div>
            </div>
            
            <div class="desktop-icon" style="top: 420px; left: 20px;" data-url="https://taobao.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #ff6600, #ff4500);">ğŸ›ï¸</div>
                <div class="icon-label">æ·˜å®</div>
            </div>
            
            <div class="desktop-icon" style="top: 420px; left: 120px;" data-url="https://baidu.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #2932e1, #0066cc);">ğŸ”</div>
                <div class="icon-label">ç™¾åº¦</div>
            </div>
            
            <div class="desktop-icon" style="top: 420px; left: 220px;" data-url="https://weibo.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #e6162d, #c71c30);">ğŸ“±</div>
                <div class="icon-label">å¾®åš</div>
            </div>
        </div>

        <!-- å±å¹•2 -->
        <div class="screen" data-screen="1">
            <div class="desktop-icon" style="top: 20px; left: 20px;" data-url="https://netflix.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #e50914, #b20710);">ğŸ¬</div>
                <div class="icon-label">Netflix</div>
            </div>
            
            <div class="desktop-icon" style="top: 20px; left: 120px;" data-url="https://spotify.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #1db954, #1ed760);">ğŸµ</div>
                <div class="icon-label">Spotify</div>
            </div>
            
            <div class="desktop-icon" style="top: 20px; left: 220px;" data-url="https://amazon.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #ff9900, #e68a00);">ğŸ›’</div>
                <div class="icon-label">Amazon</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; left: 20px;" data-url="https://discord.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #7289da, #5b6eae);">ğŸ’¬</div>
                <div class="icon-label">Discord</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; left: 120px;" data-url="https://twitch.tv">
                <div class="icon-image" style="background: linear-gradient(135deg, #9146ff, #772ce8);">ğŸ®</div>
                <div class="icon-label">Twitch</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; left: 220px;" data-url="https://reddit.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #ff4500, #ff5700);">ğŸ¤–</div>
                <div class="icon-label">Reddit</div>
            </div>
            
            <div class="desktop-icon" style="top: 220px; left: 20px;" data-url="https://pinterest.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #bd081c, #e60023);">ğŸ“Œ</div>
                <div class="icon-label">Pinterest</div>
            </div>
            
            <div class="desktop-icon" style="top: 220px; left: 120px;" data-url="https://snapchat.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #fffc00, #ffcc00);">ğŸ‘»</div>
                <div class="icon-label">Snapchat</div>
            </div>
            
            <div class="desktop-icon" style="top: 220px; left: 220px;" data-url="https://tiktok.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #ff0050, #00f2ea);">ğŸµ</div>
                <div class="icon-label">TikTok</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 20px;" data-url="https://zoom.us">
                <div class="icon-image" style="background: linear-gradient(135deg, #2d8cff, #0078d4);">ğŸ¥</div>
                <div class="icon-label">Zoom</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 120px;" data-url="https://skype.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #00aff0, #0078d4);">ğŸ“</div>
                <div class="icon-label">Skype</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 220px;" data-url="https://paypal.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #003087, #009cde);">ğŸ’³</div>
                <div class="icon-label">PayPal</div>
            </div>
        </div>

        <!-- å±å¹•3 -->
        <div class="screen" data-screen="2">
            <div class="desktop-icon" style="top: 20px; left: 20px;" data-url="https://adobe.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #ff0000, #cc0000);">ğŸ“·</div>
                <div class="icon-label">Adobe</div>
            </div>
            
            <div class="desktop-icon" style="top: 20px; left: 120px;" data-url="https://canva.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #00c4cc, #00b4d8);">âœ¨</div>
                <div class="icon-label">Canva</div>
            </div>
            
            <div class="desktop-icon" style="top: 20px; left: 220px;" data-url="https://trello.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #0079bf, #0052cc);">ğŸ“‹</div>
                <div class="icon-label">Trello</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; left: 20px;" data-url="https://slack.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #4a154b, #611f69);">ğŸ’¬</div>
                <div class="icon-label">Slack</div>
            </div>
            
            <div class="desktop-icon" style="top: 120px; left: 120px;" data-url="https://dropbox.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #0061ff, #0ea5e9);">â˜ï¸</div>
                <div class="icon-label">Dropbox</div>
            </div>
            
            <div class="desktop-icon" style="top: 220px; left: 20px;" data-url="https://figma.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #f24e1e, #a259ff);">ğŸ¨</div>
                <div class="icon-label">Figma</div>
            </div>
            
            <div class="desktop-icon" style="top: 220px; left: 120px;" data-url="https://behance.net">
                <div class="icon-image" style="background: linear-gradient(135deg, #1769ff, #0d47a1);">ğŸ¨</div>
                <div class="icon-label">Behance</div>
            </div>
            
            <div class="desktop-icon" style="top: 220px; left: 220px;" data-url="https://dribbble.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #ea4c89, #d6336c);">ğŸ€</div>
                <div class="icon-label">Dribbble</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 20px;" data-url="https://wordpress.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #21759b, #1e88e5);">âœï¸</div>
                <div class="icon-label">WordPress</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 120px;" data-url="https://medium.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #00ab6c, #00cc88);">ğŸ“°</div>
                <div class="icon-label">Medium</div>
            </div>
            
            <div class="desktop-icon" style="top: 320px; left: 220px;" data-url="https://coursera.org">
                <div class="icon-image" style="background: linear-gradient(135deg, #0056d3, #1f7ae0);">ğŸ“</div>
                <div class="icon-label">Coursera</div>
            </div>
            
            <div class="desktop-icon" style="top: 420px; left: 20px;" data-url="https://khanacademy.org">
                <div class="icon-image" style="background: linear-gradient(135deg, #14bf96, #00a085);">ğŸ§ </div>
                <div class="icon-label">Khan Academy</div>
            </div>
            
            <div class="desktop-icon" style="top: 420px; left: 120px;" data-url="https://duolingo.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #58cc02, #89e219);">ğŸ¦‰</div>
                <div class="icon-label">Duolingo</div>
            </div>
            
            <div class="desktop-icon" style="top: 420px; left: 220px;" data-url="https://Udemy.com">
                <div class="icon-image" style="background: linear-gradient(135deg, #a435f0, #7b22d3);">ğŸ’»</div>
                <div class="icon-label">Udemy</div>
            </div>
        </div>
    </div>

    <!-- å±å¹•åˆ‡æ¢ç‚¹ -->
    <div class="screen-switch">
        <div class="screen-dot active" data-screen="0"></div>
        <div class="screen-dot" data-screen="1"></div>
        <div class="screen-dot" data-screen="2"></div>
    </div>

    <!-- é¡µé¢æŒ‡ç¤ºå™¨ -->
    <div class="page-indicator">
        <div class="page-dot active"></div>
        <div class="page-dot"></div>
        <div class="page-dot"></div>
    </div>

    <!-- åº•éƒ¨å·¥å…·æ  -->
    <div class="toolbar">
        <button class="tool-btn" onclick="addBookmark()" title="æ·»åŠ ä¹¦ç­¾">
            â•
        </button>
        <button class="tool-btn" id="deleteModeBtn" onclick="toggleDeleteMode()" title="åˆ é™¤ä¹¦ç­¾" style="display: none;">
            â–
        </button>

        <button class="tool-btn" onclick="resetLayout()" title="é‡ç½®å¸ƒå±€">
            ğŸ”„
        </button>
        <button class="tool-btn" onclick="help()" title="å¸®åŠ©">
            â“
        </button>
    </div>

    <!-- æ‹–æ‹½æŒ‡ç¤ºå™¨ -->
    <div class="drag-indicator" id="dragIndicator"></div>

    <!-- æ·»åŠ ä¹¦ç­¾å¼¹çª— -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="add-bookmark-modal" id="addBookmarkModal">
        <div class="modal-header">æ·»åŠ æ–°ä¹¦ç­¾</div>
        <div class="form-group">
            <label class="form-label">ç½‘ç«™åç§°</label>
            <input type="text" class="form-input" id="bookmarkName" placeholder="è¾“å…¥ç½‘ç«™åç§°">
        </div>
        <div class="form-group">
            <label class="form-label">ç½‘ç«™åœ°å€</label>
            <div class="url-input-group">
                <input type="url" class="form-input" id="bookmarkUrl" placeholder="https://example.com">
                <button type="button" class="btn btn-small" onclick="fetchFavicon()">è·å–ç½‘ç«™çš„å›¾æ ‡</button>
            </div>
            <div class="favicon-preview" id="faviconPreview" style="display: none;">
                <img id="faviconImage" src="" alt="ç½‘ç«™å›¾æ ‡">
                <span id="faviconDomain"></span>
                <button type="button" class="btn btn-small" onclick="useFavicon()">ä½¿ç”¨æ­¤å›¾æ ‡</button>
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">é€‰æ‹©å›¾æ ‡ï¼ˆEmojiï¼‰</label>
            <div class="emoji-selector">
                <div class="emoji-options">
                    <span class="emoji-option" data-emoji="ğŸŒ">ğŸŒ</span>
                    <span class="emoji-option" data-emoji="ğŸ’»">ğŸ’»</span>
                    <span class="emoji-option" data-emoji="ğŸ“±">ğŸ“±</span>
                    <span class="emoji-option" data-emoji="ğŸ¨">ğŸ¨</span>
                    <span class="emoji-option" data-emoji="ğŸ“">ğŸ“</span>
                    <span class="emoji-option" data-emoji="ğŸ¬">ğŸ¬</span>
                    <span class="emoji-option" data-emoji="ğŸµ">ğŸµ</span>
                    <span class="emoji-option" data-emoji="ğŸ“š">ğŸ“š</span>
                    <span class="emoji-option" data-emoji="ğŸ›’">ğŸ›’</span>
                    <span class="emoji-option" data-emoji="ğŸ’¬">ğŸ’¬</span>
                    <span class="emoji-option" data-emoji="ğŸ®">ğŸ®</span>
                    <span class="emoji-option" data-emoji="ğŸ“·">ğŸ“·</span>
                    <span class="emoji-option" data-emoji="âœˆï¸">âœˆï¸</span>
                    <span class="emoji-option" data-emoji="ğŸ•">ğŸ•</span>
                    <span class="emoji-option" data-emoji="âš½">âš½</span>
                    <span class="emoji-option" data-emoji="ğŸ“">ğŸ“</span>
                </div>
                <input type="text" class="form-input" id="bookmarkIcon" placeholder="ğŸŒ" maxlength="2">
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeAddBookmark()">å–æ¶ˆ</button>
            <button class="btn btn-primary" onclick="saveBookmark()">æ·»åŠ </button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentScreen = 0;
        let dragState = {
            isDragging: false,
            draggedElement: null,
            originalPosition: null,
            originalScreen: null
        };
        let clickTimer = null;
        let clickCount = 0;
        let lastClickedElement = null;

        // Google Favicon APIç›¸å…³çš„å…¨å±€å˜é‡
        let currentFaviconData = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateIndicators();
            
            // å°è¯•åŠ è½½ä¿å­˜çš„é…ç½®
            const loaded = loadDesktopConfig();
            
            if (!loaded) {
                console.log('ä½¿ç”¨é»˜è®¤é…ç½®');
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„é…ç½®ï¼Œç¡®ä¿åˆ é™¤å°å‰æ­£ç¡®æ˜¾ç¤º
                addDeleteCrossesToIcons();
            }
        });

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // å±å¹•åˆ‡æ¢
            document.querySelectorAll('.screen-dot').forEach((dot, index) => {
                dot.addEventListener('click', () => switchScreen(index));
            });

            // å›¾æ ‡ç‚¹å‡»
            document.querySelectorAll('.desktop-icon').forEach(icon => {
                icon.addEventListener('click', handleIconClick);
                setupDragEvents(icon);
            });

            // é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', handleKeyboard);
            
            // æ¨¡æ€æ¡†å…³é—­
            document.getElementById('modalOverlay').addEventListener('click', closeAddBookmark);
            
            // Emojié€‰æ‹©å™¨
            setupEmojiSelector();
            
            // ä¸ºç°æœ‰å›¾æ ‡æ·»åŠ åˆ é™¤å°å‰
            addDeleteCrossesToIcons();
        }

        // ä¸ºæ‰€æœ‰å›¾æ ‡æ·»åŠ åˆ é™¤å°å‰
        function addDeleteCrossesToIcons() {
            document.querySelectorAll('.desktop-icon').forEach(icon => {
                if (!icon.querySelector('.delete-cross')) {
                    const deleteCross = document.createElement('div');
                    deleteCross.className = 'delete-cross';
                    deleteCross.textContent = 'Ã—';
                    deleteCross.onclick = function(e) {
                        e.stopPropagation();
                        deleteIcon(this);
                    };
                    icon.insertBefore(deleteCross, icon.firstChild);
                }
            });
        }

        // åˆ‡æ¢åˆ é™¤æ¨¡å¼
        let deleteMode = false;
        function toggleDeleteMode() {
            deleteMode = !deleteMode;
            const desktop = document.getElementById('desktop');
            const deleteBtn = document.getElementById('deleteModeBtn');
            
            if (deleteMode) {
                desktop.classList.add('delete-mode');
                deleteBtn.style.display = 'block';
                deleteBtn.innerHTML = 'âœ…';
                deleteBtn.title = 'é€€å‡ºåˆ é™¤æ¨¡å¼';
            } else {
                desktop.classList.remove('delete-mode');
                deleteBtn.innerHTML = 'â–';
                deleteBtn.title = 'åˆ é™¤ä¹¦ç­¾';
            }
        }

        // åˆ é™¤å›¾æ ‡å‡½æ•°
        function deleteIcon(deleteCrossElement) {
            const icon = deleteCrossElement.parentElement;
            icon.style.animation = 'fadeOut 0.2s ease';
            setTimeout(() => {
                icon.remove();
                
                // ä¿å­˜é…ç½®
                saveDesktopConfig();
            }, 200);
        }

        // æ·»åŠ åˆ é™¤æŒ‰é’®åˆ°åˆå§‹æ˜¾ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶è¿Ÿæ˜¾ç¤ºåˆ é™¤æŒ‰é’®ï¼Œç¡®ä¿DOMåŠ è½½å®Œæˆ
            setTimeout(() => {
                const deleteBtn = document.getElementById('deleteModeBtn');
                if (deleteBtn) {
                    deleteBtn.style.display = 'block';
                }
            }, 100);
        });

        // å±å¹•åˆ‡æ¢
        function switchScreen(screenIndex) {
            // éšè—å½“å‰å±å¹•
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡å±å¹•
            document.querySelector(`[data-screen="${screenIndex}"]`).classList.add('active');
            
            // æ›´æ–°æŒ‡ç¤ºå™¨
            document.querySelectorAll('.screen-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === screenIndex);
            });
            
            document.querySelectorAll('.page-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === screenIndex);
            });
            
            currentScreen = screenIndex;
        }

        // å›¾æ ‡ç‚¹å‡»å¤„ç†ï¼ˆåŒå‡»æ‰“å¼€ï¼‰
        function handleIconClick(event) {
            const currentElement = event.currentTarget;
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (clickTimer) {
                clearTimeout(clickTimer);
                clickTimer = null;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ä¸ªå…ƒç´ çš„è¿ç»­ç‚¹å‡»
            if (lastClickedElement === currentElement) {
                clickCount++;
            } else {
                clickCount = 1;
                lastClickedElement = currentElement;
            }
            
            // å¦‚æœæ˜¯åŒå‡»
            if (clickCount === 2) {
                // æ¸…é™¤å®šæ—¶å™¨å’Œè®¡æ•°
                clearTimeout(clickTimer);
                clickTimer = null;
                clickCount = 0;
                lastClickedElement = null;
                
                // æ‰“å¼€ç½‘å€
                const url = currentElement.dataset.url;
                if (url) {
                    // ä½¿ç”¨é€šç”¨URLå¤„ç†å‡½æ•°ç¡®ä¿æ­£ç¡®è®¿é—®
                    const fullUrl = normalizeUrl(url);
                    window.open(fullUrl, '_blank');
                }
            } else {
                // è®¾ç½®å®šæ—¶å™¨ï¼Œå¦‚æœ300mså†…æ²¡æœ‰ç¬¬äºŒæ¬¡ç‚¹å‡»ï¼Œåˆ™è®¤ä¸ºæ˜¯å•å‡»
                clickTimer = setTimeout(() => {
                    clickCount = 0;
                    lastClickedElement = null;
                    clickTimer = null;
                }, 300);
            }
        }

        // æ‹–æ‹½åŠŸèƒ½è®¾ç½®
        function setupDragEvents(element) {
            element.addEventListener('mousedown', startDrag);
            element.addEventListener('touchstart', startDrag);
        }

        // å¼€å§‹æ‹–æ‹½
        function startDrag(event) {
            event.preventDefault();
            const element = event.currentTarget;
            
            dragState.isDragging = true;
            dragState.draggedElement = element;
            dragState.originalPosition = {
                left: element.style.left,
                top: element.style.top
            };
            
            // è®°å½•åŸå§‹å±å¹•
            dragState.originalScreen = currentScreen;
            
            element.classList.add('dragging');
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', endDrag);
        }

        // æ‹–æ‹½è¿‡ç¨‹
        function drag(event) {
            if (!dragState.isDragging) return;
            
            const draggedElement = dragState.draggedElement;
            const rect = draggedElement.getBoundingClientRect();
            const desktopRect = document.getElementById('desktop').getBoundingClientRect();
            
            let clientX, clientY;
            if (event.type === 'touchmove') {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }
            
            const newLeft = Math.max(0, Math.min(clientX - desktopRect.left - rect.width / 2, desktopRect.width - rect.width));
            const newTop = Math.max(0, Math.min(clientY - desktopRect.top - rect.height / 2, desktopRect.height - rect.height));
            
            draggedElement.style.left = newLeft + 'px';
            draggedElement.style.top = newTop + 'px';
            
            // æ£€æµ‹æ˜¯å¦æ‚¬åœåœ¨å±å¹•åˆ‡æ¢æŒ‰é’®ä¸Š
            checkScreenSwitch(clientX, clientY);
        }
        
        // æ£€æµ‹å±å¹•åˆ‡æ¢
        function checkScreenSwitch(mouseX, mouseY) {
            const screenDots = document.querySelectorAll('.screen-dot');
            
            for (let i = 0; i < screenDots.length; i++) {
                const dot = screenDots[i];
                const dotRect = dot.getBoundingClientRect();
                
                // æ£€æµ‹é¼ æ ‡æ˜¯å¦åœ¨åœ†ç‚¹åŒºåŸŸå†…
                if (mouseX >= dotRect.left && mouseX <= dotRect.right && 
                    mouseY >= dotRect.top && mouseY <= dotRect.bottom) {
                    
                    // å¦‚æœä¸æ˜¯å½“å‰å±å¹•ï¼Œåˆ™åˆ‡æ¢
                    if (i !== currentScreen) {
                        // ä¸´æ—¶åˆ‡æ¢å±å¹•
                        switchScreen(i);
                        
                        // ç§»åŠ¨å›¾æ ‡åˆ°æ–°å±å¹•
                        moveIconToScreen(dragState.draggedElement, dragState.originalScreen, i);
                        break;
                    }
                }
            }
        }
        
        // ç§»åŠ¨å›¾æ ‡åˆ°æŒ‡å®šå±å¹•
        function moveIconToScreen(icon, fromScreen, toScreen) {
            // ä»åŸå§‹å±å¹•ç§»é™¤
            const originalScreen = document.querySelector(`[data-screen="${fromScreen}"]`);
            if (originalScreen && originalScreen.contains(icon)) {
                originalScreen.removeChild(icon);
            }
            
            // æ·»åŠ åˆ°ç›®æ ‡å±å¹•
            const targetScreen = document.querySelector(`[data-screen="${toScreen}"]`);
            if (targetScreen) {
                targetScreen.appendChild(icon);
                
                // éšæœºå®šä½åˆ°ç›®æ ‡å±å¹•çš„æ–°ä½ç½®
                const screenRect = targetScreen.getBoundingClientRect();
                const iconWidth = 80; // å‡è®¾å›¾æ ‡å®½åº¦
                const iconHeight = 100; // å‡è®¾å›¾æ ‡é«˜åº¦
                
                const randomLeft = Math.random() * (screenRect.width - iconWidth);
                const randomTop = Math.random() * (screenRect.height - iconHeight);
                
                icon.style.left = randomLeft + 'px';
                icon.style.top = randomTop + 'px';
            }
        }

        // ç»“æŸæ‹–æ‹½
        function endDrag() {
            if (!dragState.isDragging) return;
            
            const draggedElement = dragState.draggedElement;
            draggedElement.classList.remove('dragging');
            
            // é˜²é‡å é€»è¾‘ - åƒæ‰‹æœºå±å¹•ä¸€æ ·
            const finalPosition = findNonOverlappingPosition(draggedElement);
            
            // åº”ç”¨æœ€ç»ˆä½ç½®
            draggedElement.style.left = finalPosition.left + 'px';
            draggedElement.style.top = finalPosition.top + 'px';
            
            // ä¿æŒæ‹–æ‹½çŠ¶æ€ä¸€ä¼šå„¿ï¼Œé¿å…è§¦å‘ç‚¹å‡»äº‹ä»¶
            const finishedElement = dragState.draggedElement;
            
            dragState.isDragging = false;
            dragState.draggedElement = null;
            dragState.originalPosition = null;
            
            // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', endDrag);
            
            // ä¿å­˜é…ç½®
            setTimeout(() => {
                saveDesktopConfig();
            }, 100);
        }

        // ç½‘æ ¼ç³»ç»Ÿé…ç½®
        const GRID_SIZE = 100; // ç½‘æ ¼å¤§å°
        const GRID_OFFSET_X = 20; // ç½‘æ ¼èµ·å§‹Xåç§»
        const GRID_OFFSET_Y = 20; // ç½‘æ ¼èµ·å§‹Yåç§»
        
        // å¯»æ‰¾ä¸é‡å çš„ä½ç½®ï¼ˆç±»ä¼¼æ‰‹æœºå±å¹•ï¼Œä½¿ç”¨ç½‘æ ¼å¯¹é½ï¼‰
        function findNonOverlappingPosition(draggedElement) {
            const currentScreenElement = document.querySelector(`[data-screen="${currentScreen}"]`);
            const screenRect = currentScreenElement.getBoundingClientRect();
            const iconRect = draggedElement.getBoundingClientRect();
            
            // è·å–å½“å‰æ‹–æ‹½çš„ä½ç½®å¹¶å¯¹é½åˆ°ç½‘æ ¼
            let currentLeft = parseInt(draggedElement.style.left) || iconRect.left - screenRect.left;
            let currentTop = parseInt(draggedElement.style.top) || iconRect.top - screenRect.top;
            
            // å¯¹é½åˆ°ç½‘æ ¼
            currentLeft = snapToGrid(currentLeft);
            currentTop = snapToGrid(currentTop);
            
            // æ£€æŸ¥æ˜¯å¦ä¸ç°æœ‰å›¾æ ‡é‡å 
            if (!hasOverlap(draggedElement, currentLeft, currentTop)) {
                return { left: currentLeft, top: currentTop };
            }
            
            // å¦‚æœæœ‰é‡å ï¼Œå°è¯•å¯»æ‰¾é™„è¿‘çš„ç½‘æ ¼ä½ç½®
            const nearbyPosition = findNearestAvailableGridPosition(draggedElement, currentLeft, currentTop);
            if (nearbyPosition) {
                return nearbyPosition;
            }
            
            // å¦‚æœé™„è¿‘æ²¡æœ‰ç½‘æ ¼ä½ç½®ï¼Œé€‰æ‹©ä¸€ä¸ªéšæœºç½‘æ ¼ä½ç½®
            return getRandomGridPosition(draggedElement);
        }

        // å°†ä½ç½®å¯¹é½åˆ°ç½‘æ ¼
        function snapToGrid(value) {
            return Math.round((value - GRID_OFFSET_X) / GRID_SIZE) * GRID_SIZE + GRID_OFFSET_X;
        }

        // è·å–æ‰€æœ‰å¯ç”¨çš„ç½‘æ ¼ä½ç½®
        function getAllGridPositions() {
            const positions = [];
            const maxCols = 7; // å±å¹•å®½åº¦çº¦700pxï¼Œæ¯æ ¼100px
            const maxRows = 5; // å±å¹•é«˜åº¦çº¦500pxï¼Œæ¯æ ¼100px
            
            for (let row = 0; row < maxRows; row++) {
                for (let col = 0; col < maxCols; col++) {
                    const left = GRID_OFFSET_X + col * GRID_SIZE;
                    const top = GRID_OFFSET_Y + row * GRID_SIZE;
                    positions.push({ left, top });
                }
            }
            return positions;
        }

        // å¯»æ‰¾æœ€è¿‘çš„å¯ç”¨ç½‘æ ¼ä½ç½®
        function findNearestAvailableGridPosition(draggedElement, originalLeft, originalTop) {
            const allGridPositions = getAllGridPositions();
            const availablePositions = allGridPositions.filter(pos => 
                !hasOverlap(draggedElement, pos.left, pos.top)
            );
            
            if (availablePositions.length === 0) return null;
            
            // è®¡ç®—è·ç¦»ï¼Œæ‰¾åˆ°æœ€è¿‘çš„
            let nearestPos = null;
            let minDistance = Infinity;
            
            for (let pos of availablePositions) {
                const distance = Math.sqrt(
                    Math.pow(pos.left - originalLeft, 2) + 
                    Math.pow(pos.top - originalTop, 2)
                );
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestPos = pos;
                }
            }
            
            return nearestPos;
        }

        // è·å–éšæœºç½‘æ ¼ä½ç½®
        function getRandomGridPosition(draggedElement) {
            const allGridPositions = getAllGridPositions();
            const availablePositions = allGridPositions.filter(pos => 
                !hasOverlap(draggedElement, pos.left, pos.top)
            );
            
            if (availablePositions.length > 0) {
                return availablePositions[Math.floor(Math.random() * availablePositions.length)];
            }
            
            // å¦‚æœæ²¡æœ‰å¯ç”¨ä½ç½®ï¼Œè¿”å›ä¸­å¿ƒä½ç½®
            return { left: 250, top: 150 };
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰é‡å 
        function hasOverlap(element, left, top) {
            const currentScreenElement = document.querySelector(`[data-screen="${currentScreen}"]`);
            const allIcons = currentScreenElement.querySelectorAll('.desktop-icon');
            
            const elementRect = {
                left: left,
                top: top,
                right: left + 80,
                bottom: top + 90
            };
            
            for (let icon of allIcons) {
                if (icon === element) continue;
                
                const iconLeft = parseInt(icon.style.left) || 0;
                const iconTop = parseInt(icon.style.top) || 0;
                
                const iconRect = {
                    left: iconLeft,
                    top: iconTop,
                    right: iconLeft + 80,
                    bottom: iconTop + 90
                };
                
                // æ£€æŸ¥çŸ©å½¢æ˜¯å¦é‡å 
                if (elementRect.left < iconRect.right && 
                    elementRect.right > iconRect.left &&
                    elementRect.top < iconRect.bottom && 
                    elementRect.bottom > iconRect.top) {
                    return true;
                }
            }
            
            return false;
        }

        // å¯»æ‰¾é™„è¿‘å¯ç”¨çš„ä½ç½®
        function findNearestAvailablePosition(draggedElement, originalLeft, originalTop) {
            const searchRadius = [20, 40, 60, 80, 100]; // é€æ¸æ‰©å¤§æœç´¢åŠå¾„
            const directions = [
                { dx: 0, dy: -1 }, { dx: 1, dy: -1 }, { dx: 1, dy: 0 }, { dx: 1, dy: 1 },
                { dx: 0, dy: 1 }, { dx: -1, dy: 1 }, { dx: -1, dy: 0 }, { dx: -1, dy: -1 }
            ];
            
            for (let radius of searchRadius) {
                for (let dir of directions) {
                    const newLeft = originalLeft + dir.dx * radius;
                    const newTop = originalTop + dir.dy * radius;
                    
                    // æ£€æŸ¥ä½ç½®æ˜¯å¦åœ¨å±å¹•èŒƒå›´å†…
                    if (newLeft >= 0 && newTop >= 0 && 
                        newLeft <= 620 && newTop <= 420) { // å±å¹•å¤§å°å‡å»å›¾æ ‡å¤§å°
                        
                        // æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦å¯ç”¨
                        if (!hasOverlap(draggedElement, newLeft, newTop)) {
                            return { left: newLeft, top: newTop };
                        }
                    }
                }
            }
            
            return null;
        }

        // è·å–éšæœºå¯ç”¨ä½ç½®
        function getRandomAvailablePosition(draggedElement) {
            const currentScreenElement = document.querySelector(`[data-screen="${currentScreen}"]`);
            const screenRect = currentScreenElement.getBoundingClientRect();
            
            // å°è¯•æ‰¾åˆ°éšæœºä½ç½®
            for (let i = 0; i < 50; i++) { // æœ€å¤šå°è¯•50æ¬¡
                const randomLeft = Math.random() * (screenRect.width - 80);
                const randomTop = Math.random() * (screenRect.height - 90);
                
                if (!hasOverlap(draggedElement, randomLeft, randomTop)) {
                    return { left: randomLeft, top: randomTop };
                }
            }
            
            // å¦‚æœ50æ¬¡éƒ½æ‰¾ä¸åˆ°ï¼Œå°±æ”¾åœ¨å±å¹•ä¸­å¿ƒé™„è¿‘
            return { left: 250, top: 150 };
        }

        // æ˜¾ç¤ºæ‹–æ‹½æŒ‡ç¤ºå™¨
        function showDragIndicator(element) {
            const indicator = document.getElementById('dragIndicator');
            const rect = element.getBoundingClientRect();
            const desktopRect = document.getElementById('desktop').getBoundingClientRect();
            
            indicator.style.left = (rect.left - desktopRect.left - 5) + 'px';
            indicator.style.top = (rect.top - desktopRect.top - 5) + 'px';
            indicator.style.width = (rect.width + 10) + 'px';
            indicator.style.height = (rect.height + 10) + 'px';
            indicator.classList.add('active');
        }

        // æ›´æ–°æ‹–æ‹½æŒ‡ç¤ºå™¨
        function updateDragIndicator(element) {
            const indicator = document.getElementById('dragIndicator');
            const rect = element.getBoundingClientRect();
            const desktopRect = document.getElementById('desktop').getBoundingClientRect();
            
            indicator.style.left = (rect.left - desktopRect.left - 5) + 'px';
            indicator.style.top = (rect.top - desktopRect.top - 5) + 'px';
        }

        // éšè—æ‹–æ‹½æŒ‡ç¤ºå™¨
        function hideDragIndicator() {
            document.getElementById('dragIndicator').classList.remove('active');
        }

        // æ›´æ–°æŒ‡ç¤ºå™¨
        function updateIndicators() {
            document.querySelectorAll('.screen-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === currentScreen);
            });
            
            document.querySelectorAll('.page-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === currentScreen);
            });
        }

        // é”®ç›˜äº‹ä»¶å¤„ç†
        function handleKeyboard(event) {
            switch(event.key) {
                case 'ArrowLeft':
                    if (currentScreen > 0) {
                        switchScreen(currentScreen - 1);
                    }
                    break;
                case 'ArrowRight':
                    if (currentScreen < 2) {
                        switchScreen(currentScreen + 1);
                    }
                    break;
                case 'Escape':
                    closeAddBookmark();
                    break;
            }
        }

        // æ·»åŠ ä¹¦ç­¾
        function addBookmark() {
            document.getElementById('modalOverlay').classList.add('active');
            document.getElementById('addBookmarkModal').style.display = 'block';
        }

        // å…³é—­æ·»åŠ ä¹¦ç­¾å¼¹çª—
        function closeAddBookmark() {
            document.getElementById('modalOverlay').classList.remove('active');
            document.getElementById('addBookmarkModal').style.display = 'none';
            clearForm();
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('bookmarkName').value = '';
            document.getElementById('bookmarkUrl').value = '';
            document.getElementById('bookmarkIcon').value = '';
            
            // æ¸…é™¤emojié€‰æ‹©å™¨çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // æ¸…é™¤faviconç›¸å…³æ•°æ®å’Œé¢„è§ˆ
            currentFaviconData = null;
            showFaviconPreview('hidden');
        }

        // Emojié€‰æ‹©å™¨äº‹ä»¶å¤„ç†
        function setupEmojiSelector() {
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.addEventListener('click', function() {
                    // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.emoji-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // æ·»åŠ é€‰ä¸­çŠ¶æ€åˆ°å½“å‰é€‰é¡¹
                    this.classList.add('selected');
                    
                    // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
                    document.getElementById('bookmarkIcon').value = this.dataset.emoji;
                });
            });
        }

        // æ ‡å‡†åŒ–URLæ ¼å¼ï¼Œç¡®ä¿å¯ä»¥æ­£ç¡®è®¿é—®
        function normalizeUrl(url) {
            if (!url) return '';
            
            // ç§»é™¤å¤šä½™ç©ºæ ¼
            url = url.trim();
            
            // å¦‚æœURLå·²ç»åŒ…å«åè®®å‰ç¼€ï¼Œç›´æ¥è¿”å›
            if (url.startsWith('http://') || url.startsWith('https://')) {
                return url;
            }
            
            // å¦‚æœæ˜¯IPåœ°å€æˆ–localhostï¼Œç›´æ¥æ·»åŠ https
            if (url.startsWith('localhost') || 
                url.startsWith('127.0.0.1') ||
                /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.test(url)) {
                return 'http://' + url;
            }
            
            // é»˜è®¤ä½¿ç”¨httpsåè®®
            return 'https://' + url;
        }

        // ä»URLæå–åŸŸå
        function extractDomain(url) {
            if (!url) return '';
            
            // ä½¿ç”¨æ ‡å‡†åŒ–URLå¤„ç†
            url = normalizeUrl(url);
            
            try {
                const urlObj = new URL(url);
                return urlObj.hostname;
            } catch (error) {
                console.error('URLæ ¼å¼é”™è¯¯:', url);
                return '';
            }
        }

        // é€šè¿‡Google Favicon APIè·å–ç½‘ç«™çš„favicon
        function fetchFavicon() {
            const urlInput = document.getElementById('bookmarkUrl').value.trim();
            
            if (!urlInput) {
                alert('è¯·å…ˆè¾“å…¥ç½‘ç«™åœ°å€');
                return;
            }
            
            // ä½¿ç”¨æ ‡å‡†åŒ–URLå¤„ç†
            const normalizedUrl = normalizeUrl(urlInput);
            const domain = extractDomain(normalizedUrl);
            if (!domain) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„ç½‘ç«™åœ°å€');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showFaviconPreview('loading');
            
            // ä½¿ç”¨Google Favicon API
            const faviconUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
            
            // æµ‹è¯•å›¾ç‰‡åŠ è½½
            const img = new Image();
            img.onload = function() {
                // å›¾ç‰‡åŠ è½½æˆåŠŸ
                currentFaviconData = {
                    iconUrl: faviconUrl,
                    domain: domain,
                    originalUrl: urlInput,
                    success: true
                };
                
                updateFaviconPreview(faviconUrl, domain);
                showFaviconPreview('success');
                console.log('æˆåŠŸè·å–favicon:', faviconUrl);
            };
            
            img.onerror = function() {
                // å›¾ç‰‡åŠ è½½å¤±è´¥
                console.error('è·å–faviconå¤±è´¥');
                currentFaviconData = {
                    success: false,
                    error: 'æ— æ³•è·å–ç½‘ç«™å›¾æ ‡'
                };
                showFaviconPreview('error', 'æ— æ³•è·å–ç½‘ç«™å›¾æ ‡ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©Emoji');
            };
            
            // è®¾ç½®è¶…æ—¶
            setTimeout(() => {
                if (currentFaviconData && !currentFaviconData.success) {
                    showFaviconPreview('error', 'è·å–å›¾æ ‡è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                }
            }, 5000);
            
            // å¼€å§‹åŠ è½½å›¾ç‰‡
            img.src = faviconUrl;
        }

        // æ˜¾ç¤ºfaviconé¢„è§ˆ
        function showFaviconPreview(status, errorMessage = '') {
            const preview = document.getElementById('faviconPreview');
            const domainSpan = document.getElementById('faviconDomain');
            
            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            preview.classList.remove('loading', 'success', 'error');
            
            switch (status) {
                case 'loading':
                    preview.classList.add('loading');
                    preview.style.display = 'flex';
                    domainSpan.textContent = 'æ­£åœ¨è·å–å›¾æ ‡...';
                    break;
                case 'success':
                    preview.classList.add('success');
                    preview.style.display = 'flex';
                    break;
                case 'error':
                    preview.classList.add('error');
                    preview.style.display = 'flex';
                    domainSpan.textContent = errorMessage || 'è·å–å›¾æ ‡å¤±è´¥';
                    break;
                case 'hidden':
                default:
                    preview.style.display = 'none';
                    break;
            }
        }

        // æ›´æ–°faviconé¢„è§ˆå†…å®¹
        function updateFaviconPreview(imageUrl, domain) {
            const img = document.getElementById('faviconImage');
            const domainSpan = document.getElementById('faviconDomain');
            
            img.src = imageUrl;
            img.alt = domain;
            domainSpan.textContent = domain;
        }

        // ä½¿ç”¨faviconä½œä¸ºå›¾æ ‡
        function useFavicon() {
            if (!currentFaviconData) {
                alert('è¯·å…ˆè·å–ç½‘ç«™å›¾æ ‡');
                return;
            }
            
            // åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„faviconå›¾æ ‡æ•°æ®
            const faviconIcon = {
                type: 'favicon',
                url: currentFaviconData.url,
                domain: currentFaviconData.domain
            };
            
            // å°†faviconæ•°æ®å­˜å‚¨åˆ°éšè—å­—æ®µ
            const iconInput = document.getElementById('bookmarkIcon');
            iconInput.value = JSON.stringify(faviconIcon);
            
            // æ¸…é™¤emojié€‰æ‹©å™¨çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // æ˜¾ç¤ºæç¤º
            showFaviconPreview('success');
            alert('å·²é€‰æ‹©ä½¿ç”¨ç½‘ç«™å›¾æ ‡ï¼æ·»åŠ ä¹¦ç­¾åå°†æ˜¾ç¤ºç½‘ç«™çš„çœŸå®å›¾æ ‡ã€‚');
            
            console.log('é€‰æ‹©ä½¿ç”¨favicon:', currentFaviconData);
        }

        // ä¿å­˜ä¹¦ç­¾
        function saveBookmark() {
            const name = document.getElementById('bookmarkName').value.trim();
            const url = document.getElementById('bookmarkUrl').value.trim();
            const icon = document.getElementById('bookmarkIcon').value.trim() || 'ğŸŒ';
            
            if (name && url) {
                const currentScreenElement = document.querySelector(`[data-screen="${currentScreen}"]`);
                
                // ç¡®å®šä½¿ç”¨çš„å›¾æ ‡ç±»å‹
                const useFavicon = currentFaviconData && currentFaviconData.success;
                const iconData = useFavicon ? currentFaviconData.iconUrl : icon;
                const iconType = useFavicon ? 'favicon' : 'emoji';
                
                // è·å–éšæœºç½‘æ ¼ä½ç½®
                const tempIcon = createNewIcon(name, url, iconData, iconType);
                const position = getRandomGridPosition(tempIcon);
                
                // åˆ›å»ºæ–°å›¾æ ‡å¹¶è®¾ç½®ä½ç½®
                const newIcon = createNewIconWithPosition(name, url, iconData, position.left, position.top, iconType);
                
                // æ·»åŠ åˆ°å½“å‰å±å¹•
                currentScreenElement.appendChild(newIcon);
                
                // ä¸ºæ–°å›¾æ ‡æ·»åŠ äº‹ä»¶ç›‘å¬
                setupDragEvents(newIcon);
                newIcon.addEventListener('click', handleIconClick);
                
                console.log('æ·»åŠ ä¹¦ç­¾:', { name, url, icon: iconData, iconType, screen: currentScreen });
                alert('ä¹¦ç­¾æ·»åŠ æˆåŠŸï¼');
                closeAddBookmark();
                
                // ä¿å­˜é…ç½®
                saveDesktopConfig();
            } else {
                alert('è¯·å¡«å†™å®Œæ•´çš„ä¹¦ç­¾ä¿¡æ¯');
            }
        }

        // åˆ›å»ºæ–°å›¾æ ‡ï¼ˆä¸´æ—¶ç‰ˆæœ¬ï¼Œä¸è®¾ç½®ä½ç½®ï¼‰
        function createNewIcon(name, url, iconEmoji, iconType = 'emoji') {
            const icon = document.createElement('div');
            icon.className = 'desktop-icon';
            icon.setAttribute('data-url', url);
            icon.setAttribute('data-icon-type', iconType);
            
            // åˆ›å»ºåˆ é™¤å°å‰
            const deleteCross = document.createElement('div');
            deleteCross.className = 'delete-cross';
            deleteCross.textContent = 'Ã—';
            deleteCross.onclick = function(e) {
                e.stopPropagation();
                deleteIcon(this);
            };
            
            // åˆ›å»ºå›¾æ ‡å›¾ç‰‡
            const iconImage = document.createElement('div');
            iconImage.className = 'icon-image';
            
            if (iconType === 'favicon' && iconEmoji.startsWith('http')) {
                // ä½¿ç”¨faviconå›¾ç‰‡
                iconImage.style.backgroundImage = `url(${iconEmoji})`;
                iconImage.style.backgroundSize = 'cover';
                iconImage.style.backgroundPosition = 'center';
                iconImage.style.backgroundRepeat = 'no-repeat';
                iconImage.textContent = ''; // æ¸…ç©ºæ–‡å­—å†…å®¹
                iconImage.setAttribute('data-favicon-url', iconEmoji);
            } else {
                // ä½¿ç”¨emojiå›¾æ ‡
                iconImage.style.background = getRandomGradient();
                iconImage.textContent = iconEmoji;
            }
            
            // åˆ›å»ºæ ‡ç­¾
            const iconLabel = document.createElement('div');
            iconLabel.className = 'icon-label';
            iconLabel.textContent = name;
            
            // ç»„è£…å›¾æ ‡
            icon.appendChild(deleteCross);
            icon.appendChild(iconImage);
            icon.appendChild(iconLabel);
            
            return icon;
        }

        // åˆ›å»ºæ–°å›¾æ ‡ï¼ˆå¸¦ä½ç½®è®¾ç½®ï¼‰
        function createNewIconWithPosition(name, url, iconEmoji, left, top, iconType = 'emoji') {
            const icon = createNewIcon(name, url, iconEmoji, iconType);
            
            // å¯¹é½åˆ°ç½‘æ ¼
            const snappedLeft = snapToGrid(left);
            const snappedTop = snapToGrid(top);
            icon.style.left = snappedLeft + 'px';
            icon.style.top = snappedTop + 'px';
            
            return icon;
        }

        // è·å–éšæœºæ¸å˜èƒŒæ™¯
        function getRandomGradient() {
            const gradients = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
                'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)'
            ];
            return gradients[Math.floor(Math.random() * gradients.length)];
        }



        // ä¿å­˜æ¡Œé¢é…ç½®åˆ°æœ¬åœ°å­˜å‚¨
        function saveDesktopConfig() {
            const config = {
                version: "1.0",
                timestamp: Date.now(),
                screens: []
            };
            
            // éå†æ‰€æœ‰å±å¹•æ”¶é›†å›¾æ ‡æ•°æ®
            document.querySelectorAll('.screen').forEach((screen, screenIndex) => {
                config.screens[screenIndex] = { icons: [] };
                
                screen.querySelectorAll('.desktop-icon').forEach(icon => {
                    const iconImage = icon.querySelector('.icon-image');
                    const iconType = icon.dataset.iconType || 'emoji';
                    
                    const iconData = {
                        id: icon.dataset.id || generateUniqueId(),
                        name: icon.querySelector('.icon-label').textContent,
                        url: icon.dataset.url,
                        icon: iconImage.textContent || iconImage.getAttribute('data-favicon-url') || '',
                        iconType: iconType,
                        left: parseInt(icon.style.left) || 0,
                        top: parseInt(icon.style.top) || 0,
                        background: iconImage.style.background,
                        faviconUrl: iconImage.getAttribute('data-favicon-url') || '',
                        deleteCross: icon.querySelector('.delete-cross') !== null
                    };
                    
                    config.screens[screenIndex].icons.push(iconData);
                });
            });
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('bookmarkDesktopConfig', JSON.stringify(config));
            console.log('é…ç½®å·²ä¿å­˜:', config);
        }

        // ç”Ÿæˆå”¯ä¸€ID
        function generateUniqueId() {
            return 'icon_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½é…ç½®
        function loadDesktopConfig() {
            const savedConfig = localStorage.getItem('bookmarkDesktopConfig');
            
            if (!savedConfig) {
                console.log('æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®');
                return false;
            }
            
            try {
                const config = JSON.parse(savedConfig);
                applyDesktopConfig(config);
                console.log('é…ç½®å·²åŠ è½½:', config);
                return true;
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                return false;
            }
        }

        // åº”ç”¨é…ç½®åˆ°é¡µé¢
        function applyDesktopConfig(config) {
            // å…ˆéšè—æ‰€æœ‰å±å¹•
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            config.screens.forEach((screenData, screenIndex) => {
                const screen = document.querySelector(`[data-screen="${screenIndex}"]`);
                if (!screen) return;
                
                // æ¸…ç©ºå±å¹•
                screen.innerHTML = '';
                
                // é‡æ–°åˆ›å»ºå›¾æ ‡
                screenData.icons.forEach(iconData => {
                    const icon = createIconFromData(iconData);
                    screen.appendChild(icon);
                    setupDragEvents(icon);
                    icon.addEventListener('click', handleIconClick);
                });
            });
            
            // æ¢å¤å½“å‰å±å¹•çŠ¶æ€
            switchScreen(currentScreen);
        }

        // ä»æ•°æ®åˆ›å»ºå›¾æ ‡
        function createIconFromData(iconData) {
            const icon = document.createElement('div');
            icon.className = 'desktop-icon';
            icon.setAttribute('data-url', iconData.url);
            icon.setAttribute('data-id', iconData.id);
            if (iconData.iconType) {
                icon.setAttribute('data-icon-type', iconData.iconType);
            }
            
            // åˆ›å»ºåˆ é™¤å°å‰
            if (iconData.deleteCross) {
                const deleteCross = document.createElement('div');
                deleteCross.className = 'delete-cross';
                deleteCross.textContent = 'Ã—';
                deleteCross.onclick = function(e) {
                    e.stopPropagation();
                    deleteIcon(this);
                };
                icon.appendChild(deleteCross);
            }
            
            // åˆ›å»ºå›¾æ ‡å›¾ç‰‡
            const iconImage = document.createElement('div');
            iconImage.className = 'icon-image';
            
            if (iconData.iconType === 'favicon' && iconData.faviconUrl) {
                // ä½¿ç”¨faviconå›¾ç‰‡
                iconImage.style.backgroundImage = `url(${iconData.faviconUrl})`;
                iconImage.style.backgroundSize = 'cover';
                iconImage.style.backgroundPosition = 'center';
                iconImage.style.backgroundRepeat = 'no-repeat';
                iconImage.textContent = ''; // æ¸…ç©ºæ–‡å­—å†…å®¹
                iconImage.setAttribute('data-favicon-url', iconData.faviconUrl);
            } else {
                // ä½¿ç”¨emojiå›¾æ ‡
                iconImage.style.background = iconData.background;
                iconImage.textContent = iconData.icon;
            }
            
            // åˆ›å»ºæ ‡ç­¾
            const iconLabel = document.createElement('div');
            iconLabel.className = 'icon-label';
            iconLabel.textContent = iconData.name;
            
            // ç»„è£…å›¾æ ‡
            icon.appendChild(iconImage);
            icon.appendChild(iconLabel);
            
            // è®¾ç½®ä½ç½®
            icon.style.left = iconData.left + 'px';
            icon.style.top = iconData.top + 'px';
            
            return icon;
        }

        // é‡ç½®å¸ƒå±€
        function resetLayout() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å›¾æ ‡ä½ç½®å—ï¼Ÿè¿™å°†åˆ é™¤æ‚¨çš„ä¸ªæ€§åŒ–è®¾ç½®ã€‚')) {
                // æ¸…é™¤ä¿å­˜çš„é…ç½®
                localStorage.removeItem('bookmarkDesktopConfig');
                
                // é‡æ–°åŠ è½½é¡µé¢æ˜¾ç¤ºé»˜è®¤é…ç½®
                location.reload();
            }
        }

        // å¸®åŠ©
        function help() {
            alert(`ä½¿ç”¨è¯´æ˜ï¼š

ğŸ–±ï¸ ç‚¹å‡»å›¾æ ‡ï¼šæ‰“å¼€ç½‘ç«™ï¼ˆåŒå‡»ï¼‰
ğŸ¤ é•¿æŒ‰/æ‹–æ‹½ï¼šç§»åŠ¨å›¾æ ‡ä½ç½®
ğŸ“± æ‹–æ‹½åˆ°åˆ‡æ¢ç‚¹ï¼šè·¨å±å¹•ç§»åŠ¨å›¾æ ‡
â† â†’ ç®­å¤´é”®ï¼šåˆ‡æ¢å±å¹•
â• æŒ‰é’®ï¼šæ·»åŠ æ–°ä¹¦ç­¾
ğŸ”„ æŒ‰é’®ï¼šé‡ç½®å¸ƒå±€
â“ æŒ‰é’®ï¼šæ˜¾ç¤ºå¸®åŠ©`);
        }
    </script>
</body>
</html>